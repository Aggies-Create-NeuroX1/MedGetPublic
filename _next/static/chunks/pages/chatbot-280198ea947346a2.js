(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[589],{3754:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/chatbot",function(){return s(1616)}])},1616:function(e,t,s){"use strict";s.r(t);var a=s(5893),o=s(7294),n=s(4341),r=s(2812),l=s(5870),i=s(92),c=s(4490),u=s(6434),d=s(2173),h=s(3213),_=s(436),m=s(1192),b=s(9457),g=s(1163),p=s(9463),x=s(5237),f=s.n(x),C=s(1222);t.default=()=>{let[e,t]=(0,o.useState)(""),[s,x]=(0,o.useState)([]),[j,N]=(0,o.useState)(""),y="Welcome to MedGet",[v,Z]=(0,o.useState)(!1),[M,I]=(0,o.useState)(""),[E,k]=(0,o.useState)(!1),{loggedIn:B,emailVerified:w,user:R,API_URL:T,apiRequest:S}=(0,o.useContext)(b.V),O=(0,g.useRouter)(),G=(0,o.useRef)(null),{getAuthToken:U}=(0,o.useContext)(b.V),F=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return U().then(s=>fetch("".concat(t,"/chat"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(s)},body:JSON.stringify({message:e})}).then(e=>{if(!e.ok)throw Error("Failed to send message to server");return e.json()})).then(e=>e.response)};(0,o.useEffect)(()=>{B&&w||O.push("/landing")},[B,w,O]),(0,o.useEffect)(()=>{R&&S("message-history","GET").then(e=>{x(e.message_history.slice(2))}).catch(e=>{x([]),console.error("Error fetching message history:",e)})},[R,S]),(0,o.useEffect)(()=>{let e=0,t=setInterval(()=>{N(y.slice(0,e+1)),++e===y.length&&clearInterval(t)},100);return()=>clearInterval(t)},[]),(0,o.useEffect)(()=>{G.current&&(G.current.scrollTop=G.current.scrollHeight)},[s,M]);let P=async()=>{if(!v&&""!==e.trim()){if(!B||!w){alert("Please log in and verify your email to interact with MedGet.");return}x(t=>[...t,{role:"user",content:e}]),t(""),Z(!0),I("");try{let t=await F(e,T),s=0,a=setInterval(()=>{I(t.slice(0,s+1)),++s===t.length&&(clearInterval(a),x(e=>[...e,{role:"assistant",content:t}]),Z(!1))},10)}catch(e){console.error("Error fetching bot response:",e),Z(!1)}}},X=async()=>{R&&(await S("message-history-delete","DELETE"),x([]),k(!1))};return(0,a.jsxs)(n.Z,{className:f().chatbotContainer,children:[(0,a.jsx)(n.Z,{className:f().titleContainer,children:(0,a.jsx)(r.Z,{variant:"h6",className:f().title,children:j})}),(0,a.jsxs)(n.Z,{className:f().messageContainer,ref:G,children:[s.map((e,t)=>(0,a.jsxs)(n.Z,{className:"user"===e.role?f().userMessageContainer:f().botMessageContainer,children:["user"===e.role?(0,a.jsx)(m.Z5v,{className:f().profileIcon}):(0,a.jsx)(_.gx$,{className:f().profileIcon}),(0,a.jsx)(r.Z,{variant:"body1",className:"user"===e.role?f().userMessage:f().botMessage,children:"bot"===e.role?(0,a.jsx)(p.UG,{children:e.content}):e.content})]},t)),v&&(0,a.jsxs)(n.Z,{className:f().botMessageContainer,children:[(0,a.jsx)(_.gx$,{className:f().profileIcon}),(0,a.jsxs)(r.Z,{variant:"body1",className:f().botMessage,children:[(0,a.jsx)(p.UG,{children:M}),0===M.length&&(0,a.jsx)("div",{className:f().loading})]})]})]}),(0,a.jsxs)(n.Z,{className:f().inputContainer,children:[(0,a.jsx)(l.Z,{className:f().messageInput,placeholder:"Send a message...",variant:"outlined",fullWidth:!0,value:e,onChange:e=>t(e.target.value),onKeyDown:e=>{"Enter"!==e.key||v||P()},disabled:v,sx:{backgroundColor:"#3a3a3a",borderRadius:"10px","& .MuiOutlinedInput-root":{borderRadius:"10px","& fieldset":{borderColor:"black"},"&:hover fieldset":{borderColor:"black"},"&.Mui-focused fieldset":{borderColor:"black"}},"& .MuiInputBase-input":{color:"white"}}}),(0,a.jsx)(i.Z,{disableRipple:!0,disableFocusRipple:!0,className:f().sendButton,onClick:P,disabled:v,children:(0,a.jsx)(d.Z,{})}),(0,a.jsx)(i.Z,{disableRipple:!0,disableFocusRipple:!0,className:f().memoryButton,onClick:()=>F("~"),children:(0,a.jsx)(C.Z,{})}),(0,a.jsx)(i.Z,{disableRipple:!0,disableFocusRipple:!0,className:f().deleteButton,onClick:()=>k(!0),children:(0,a.jsx)(h.Z,{})})]}),(0,a.jsx)(c.Z,{open:E,onClose:()=>k(!1),className:f().modal,children:(0,a.jsxs)(n.Z,{className:f().modalContent,children:[(0,a.jsx)(r.Z,{variant:"h6",className:f().modalText,children:"Are you sure you want to delete your chat history?"}),(0,a.jsxs)(n.Z,{className:f().modalButtons,children:[(0,a.jsx)(u.Z,{variant:"contained",color:"secondary",onClick:X,children:"Yes"}),(0,a.jsx)(u.Z,{variant:"contained",onClick:()=>k(!1),children:"No"})]})]})})]})}},5237:function(e){e.exports={chatbotContainer:"chatbot_chatbotContainer__87FXf",titleContainer:"chatbot_titleContainer__OGMoU",title:"chatbot_title___Uwnp",messageContainer:"chatbot_messageContainer__9O2Hb",userMessageContainer:"chatbot_userMessageContainer__6Kjrg",botMessageContainer:"chatbot_botMessageContainer__2enme",profileIcon:"chatbot_profileIcon__ctNon",userMessage:"chatbot_userMessage__1qsQn",botMessage:"chatbot_botMessage__i_y8C",inputContainer:"chatbot_inputContainer__h7JBf",messageInput:"chatbot_messageInput__zXCgu",sendButton:"chatbot_sendButton__hMc_U",deleteButton:"chatbot_deleteButton__Ut5y_",memoryButton:"chatbot_memoryButton__YxGxa",modal:"chatbot_modal__rZ6O1",modalContent:"chatbot_modalContent__Mvkiv",modalText:"chatbot_modalText__pKdiz",modalButtons:"chatbot_modalButtons__ogIhl",loading:"chatbot_loading__46Iv5",spin:"chatbot_spin__I1otr"}}},function(e){e.O(0,[317,365,31,888,774,179],function(){return e(e.s=3754)}),_N_E=e.O()}]);